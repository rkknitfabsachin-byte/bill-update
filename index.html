<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RK Knit Fab Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Inter,Arial;background:#f6f7fb;margin:0}
.card{max-width:720px;margin:20px auto;background:#fff;
padding:20px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h2{text-align:center;margin-bottom:16px}
input,select{width:100%;padding:12px;margin:6px 0;
border:1px solid #ddd;border-radius:10px;font-size:15px}
button{width:100%;padding:14px;border:none;border-radius:12px;
background:#111;color:#fff;font-size:16px;font-weight:600}
.total{background:#f1f1f1;font-weight:700}
</style>
</head>

<body>
<div class="card">
<h2>Fabric Entry</h2>

<input type="date" id="date">
<input placeholder="Bill Number" id="bill">

<input list="partyList" placeholder="Party Name" id="party">
<datalist id="partyList"></datalist>

<select id="location"><option value="">Location</option></select>
<select id="transport"><option value="">Transport</option></select>

<input list="itemList" placeholder="Item" id="item">
<datalist id="itemList"></datalist>

<input placeholder="No of Rolls" id="rolls">
<input placeholder="Width" id="width">
<input placeholder="Lot No" id="lotno">

<input list="colourList" placeholder="Colour" id="colour">
<datalist id="colourList"></datalist>

<input placeholder="Weight" id="weight">
<input placeholder="Rate" id="rate">
<input class="total" placeholder="Total" id="total" readonly>

<input placeholder="Entry Name" id="entry">

<button onclick="save()">SAVE ENTRY</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzta9pGX0sBlyek9m17U96fNrJhrDPz2j8Vi63q6i4-lZX9XHreQ-IS9X51dkBqiwQ/exec";

// -------- INIT --------
fetch(API+"?action=init").then(r=>r.json()).then(d=>{
  fill("partyList", d.parties);
  fill("itemList", d.items);
  fill("colourList", d.colours);
});

function fill(id, arr){
  document.getElementById(id).innerHTML =
    arr.map(v=>`<option value="${v}">`).join("");
}

// -------- PARTY CHANGE --------
party.onchange = ()=>{
  fetch(API+"?action=partyDetails&party="+encodeURIComponent(party.value))
  .then(r=>r.json()).then(d=>{
    setSelect(location,d.locations);
    setSelect(transport,d.transports);
  });
};

function setSelect(el, arr){
  el.innerHTML = "<option></option>";
  arr.forEach(v=>{
    let o=document.createElement("option");
    o.value=v; el.appendChild(o);
  });
}

// -------- TOTAL AUTO --------
[weight,rate].forEach(i=>i.oninput=()=>{
  total.value = (Number(weight.value||0)*Number(rate.value||0)).toFixed(2);
});

// -------- SAVE --------
function save(){
  fetch(API+"?action=save",{
    method:"POST",
    body:JSON.stringify({
      date:date.value,
      bill:bill.value,
      party:party.value,
      location:location.value,
      rolls:rolls.value,
      item:item.value,
      width:width.value,
      lotno:lotno.value,
      colour:colour.value,
      weight:weight.value,
      rate:rate.value,
      transport:transport.value,
      total:total.value,
      entry:entry.value
    })
  }).then(r=>r.json()).then(()=>{
    alert("Saved âœ”");
    document.querySelectorAll("input").forEach(i=>i.value="");
  });
}

// default date
date.valueAsDate = new Date();
</script>
</body>
</html>
